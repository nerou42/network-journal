apiVersion: dashboard.grafana.app/v2beta1
kind: Dashboard
metadata:
  name: 3ff25cd5-949e-4a0d-abaa-1b4c6755fbfe
  generation: 22
  creationTimestamp: '2025-08-05T18:46:49Z'
  labels: {}
  annotations: {}
spec:
  annotations:
    - kind: AnnotationQuery
      spec:
        builtIn: true
        enable: true
        hide: true
        iconColor: rgba(0, 211, 255, 1)
        name: Annotations & Alerts
        query:
          group: grafana
          kind: DataQuery
          spec: {}
          version: v0
  cursorSync: 'Off'
  editable: true
  elements:
    panel-1:
      kind: Panel
      spec:
        data:
          kind: QueryGroup
          spec:
            queries:
              - kind: PanelQuery
                spec:
                  hidden: false
                  query:
                    group: loki
                    kind: DataQuery
                    spec:
                      direction: backward
                      editorMode: code
                      expr: >-
                        avg by(report_type)
                        (count_over_time({service_name="network-journal",
                        level="INFO"}[1h]))
                      legendFormat: '{{ report_type }} {{ url }}'
                      queryType: range
                      step: 1h
                    version: v0
                  refId: A
            queryOptions: {}
            transformations: []
        description: ''
        id: 1
        links: []
        title: Report Type Distribution over Time
        vizConfig:
          group: barchart
          kind: VizConfig
          spec:
            fieldConfig:
              defaults:
                color:
                  mode: palette-classic
                custom:
                  axisBorderShow: false
                  axisCenteredZero: false
                  axisColorMode: text
                  axisLabel: ''
                  axisPlacement: auto
                  fillOpacity: 80
                  gradientMode: none
                  hideFrom:
                    legend: false
                    tooltip: false
                    viz: false
                  lineWidth: 1
                  scaleDistribution:
                    type: linear
                  thresholdsStyle:
                    mode: 'off'
                decimals: 0
                min: 0
                thresholds:
                  mode: absolute
                  steps:
                    - color: green
                      value: 0
                    - color: red
                      value: 80
                unit: none
              overrides: []
            options:
              barRadius: 0
              barWidth: 0.97
              fullHighlight: false
              groupWidth: 0.7
              legend:
                calcs: []
                displayMode: list
                placement: bottom
                showLegend: true
              orientation: auto
              showValue: never
              stacking: none
              tooltip:
                hideZeros: false
                mode: single
                sort: none
              xTickLabelRotation: 0
              xTickLabelSpacing: 100
          version: 12.2.0
    panel-2:
      kind: Panel
      spec:
        data:
          kind: QueryGroup
          spec:
            queries:
              - kind: PanelQuery
                spec:
                  hidden: false
                  query:
                    group: loki
                    kind: DataQuery
                    spec:
                      direction: backward
                      editorMode: code
                      expr: >-
                        avg(count_over_time({service_name="network-journal"} |
                        json documentUrl="body.documentUrl",
                        legacyDocumentUrl="[\"csp-report\"].documentUrl" |
                        __error__!="JSONParserErr" [1h])) by(report_type,
                        documentUrl, legacyDocumentUrl)
                      legendFormat: ''
                      queryType: range
                      step: 1h
                    version: v0
                  refId: A
            queryOptions: {}
            transformations:
              - kind: formatTime
                spec:
                  id: formatTime
                  options:
                    outputFormat: YYYY-MM-DD HH[:00]
                    timeField: Time
                    timezone: Europe/Berlin
                    useTimezone: true
              - kind: labelsToFields
                spec:
                  id: labelsToFields
                  options:
                    mode: columns
              - kind: merge
                spec:
                  id: merge
                  options: {}
              - kind: organize
                spec:
                  id: organize
                  options:
                    excludeByName: {}
                    includeByName: {}
                    indexByName:
                      Time: 0
                      Value: 3
                      documentUrl: 2
                      report_type: 1
                    renameByName:
                      Value: Occurrences
                      documentUrl: Domain
                      report_type: Type
              - kind: sortBy
                spec:
                  id: sortBy
                  options:
                    fields: {}
                    sort:
                      - desc: true
                        field: Time
        description: ''
        id: 2
        links: []
        title: Latest Logs
        vizConfig:
          group: table
          kind: VizConfig
          spec:
            fieldConfig:
              defaults:
                color:
                  mode: thresholds
                custom:
                  align: auto
                  cellOptions:
                    type: json-view
                  footer:
                    reducers: []
                  inspect: false
                thresholds:
                  mode: percentage
                  steps:
                    - color: green
                      value: 0
                    - color: yellow
                      value: 50
                    - color: red
                      value: 90
              overrides:
                - matcher:
                    id: byName
                    options: Type
                  properties:
                    - id: custom.width
                      value: 147
                - matcher:
                    id: byName
                    options: Time
                  properties:
                    - id: custom.width
                      value: 190
                - matcher:
                    id: byName
                    options: Domain
                  properties:
                    - id: custom.width
                      value: 552
            options:
              cellHeight: sm
              frameIndex: 0
              showHeader: true
              sortBy: []
          version: 12.2.0
    panel-3:
      kind: Panel
      spec:
        data:
          kind: QueryGroup
          spec:
            queries:
              - kind: PanelQuery
                spec:
                  hidden: false
                  query:
                    group: loki
                    kind: DataQuery
                    spec:
                      direction: backward
                      editorMode: code
                      expr: >-
                        avg(count_over_time({service_name="network-journal",
                        level="INFO"} [1h])) by(report_type)
                      legendFormat: '{{ report_type }}'
                      queryType: range
                      step: 1h
                    version: v0
                  refId: A
            queryOptions: {}
            transformations: []
        description: ''
        id: 3
        links: []
        title: Relative Amounts by Report Type
        vizConfig:
          group: piechart
          kind: VizConfig
          spec:
            fieldConfig:
              defaults:
                color:
                  mode: palette-classic
                custom:
                  hideFrom:
                    legend: false
                    tooltip: false
                    viz: false
                decimals: 0
                min: 0
                unit: none
              overrides: []
            options:
              displayLabels:
                - percent
                - name
              legend:
                displayMode: list
                placement: bottom
                showLegend: true
                values:
                  - percent
              pieType: pie
              reduceOptions:
                calcs:
                  - sum
                fields: ''
                values: false
              sort: desc
              tooltip:
                hideZeros: false
                mode: single
                sort: none
          version: 12.2.0
    panel-4:
      kind: Panel
      spec:
        data:
          kind: QueryGroup
          spec:
            queries:
              - kind: PanelQuery
                spec:
                  hidden: false
                  query:
                    group: loki
                    kind: DataQuery
                    spec:
                      direction: backward
                      editorMode: code
                      expr: '{service_name="network-journal"}'
                      legendFormat: ''
                      queryType: range
                    version: v0
                  refId: A
            queryOptions: {}
            transformations:
              - kind: extractFields
                spec:
                  id: extractFields
                  options:
                    delimiter: ','
                    format: json
                    jsonPaths:
                      - alias: ReportType
                        path: report_type
                      - alias: Level
                        path: level
                    source: labels
              - kind: extractFields
                spec:
                  id: extractFields
                  options:
                    delimiter: ','
                    format: json
                    jsonPaths:
                      - alias: Browser
                        path: derived.client.family
                      - alias: Path
                        path: derived.url.path
                    source: Line
              - kind: filterFieldsByName
                spec:
                  id: filterFieldsByName
                  options:
                    include:
                      names:
                        - Time
                        - Line
                        - ReportType
                        - Level
                        - Browser
                        - Path
              - kind: organize
                spec:
                  id: organize
                  options:
                    excludeByName:
                      labelTypes: false
                    includeByName: {}
                    indexByName:
                      Browser: 3
                      Level: 2
                      Line: 6
                      Path: 4
                      ReportType: 1
                      Time: 0
                      labelTypes: 5
                    renameByName: {}
              - kind: sortBy
                spec:
                  id: sortBy
                  options:
                    fields: {}
                    sort:
                      - desc: true
                        field: Time
        description: ''
        id: 4
        links: []
        title: Latest reports
        vizConfig:
          group: table
          kind: VizConfig
          spec:
            fieldConfig:
              defaults:
                color:
                  mode: thresholds
                custom:
                  align: auto
                  cellOptions:
                    type: auto
                  filterable: true
                  footer:
                    reducers: []
                  inspect: true
                thresholds:
                  mode: absolute
                  steps:
                    - color: green
                      value: 0
                    - color: red
                      value: 80
              overrides:
                - matcher:
                    id: byName
                    options: Level
                  properties:
                    - id: custom.width
                      value: 77
                - matcher:
                    id: byName
                    options: ReportType
                  properties:
                    - id: custom.width
                      value: 122
                - matcher:
                    id: byName
                    options: Time
                  properties:
                    - id: custom.width
                      value: 206
                - matcher:
                    id: byName
                    options: Browser
                  properties:
                    - id: custom.width
                      value: 115
                - matcher:
                    id: byName
                    options: Path
                  properties:
                    - id: custom.width
                      value: 324
            options:
              cellHeight: sm
              enablePagination: false
              showHeader: true
              sortBy: []
          version: 12.2.0
    panel-5:
      kind: Panel
      spec:
        data:
          kind: QueryGroup
          spec:
            queries:
              - kind: PanelQuery
                spec:
                  hidden: false
                  query:
                    group: loki
                    kind: DataQuery
                    spec:
                      direction: backward
                      editorMode: code
                      expr: >-
                        label_replace(avg by(browser)
                        (count_over_time({service_name="network-journal",
                        level="INFO"} | json browser="derived.client.family"
                        [1h])), "browser", "unknown", "browser", "^$")
                      legendFormat: '{{ report_type }}'
                      queryType: range
                      step: 1h
                    version: v0
                  refId: A
              - kind: PanelQuery
                spec:
                  hidden: true
                  query:
                    group: loki
                    kind: DataQuery
                    spec:
                      direction: backward
                      editorMode: builder
                      expr: >-
                        {service_name="network-journal", level="INFO"} | json
                        browser="derived.client.family" | browser !~
                        `Firefox|Chrome|Edge|HeadlessChrome|Firefox Mobile`
                      legendFormat: '{{ report_type }}'
                      queryType: range
                      step: 1h
                    version: v0
                  refId: B
            queryOptions: {}
            transformations: []
        description: ''
        id: 5
        links: []
        title: Relative Amounts by Browser
        vizConfig:
          group: piechart
          kind: VizConfig
          spec:
            fieldConfig:
              defaults:
                color:
                  mode: palette-classic
                custom:
                  hideFrom:
                    legend: false
                    tooltip: false
                    viz: false
              overrides:
                - matcher:
                    id: byName
                    options: unknown
                  properties:
                    - id: color
                      value:
                        fixedColor: red
                        mode: fixed
            options:
              displayLabels:
                - percent
                - name
              legend:
                displayMode: list
                placement: bottom
                showLegend: true
                values:
                  - percent
              pieType: pie
              reduceOptions:
                calcs:
                  - sum
                fields: ''
                values: false
              sort: desc
              tooltip:
                hideZeros: false
                mode: single
                sort: none
          version: 12.2.0
  layout:
    kind: GridLayout
    spec:
      items:
        - kind: GridLayoutItem
          spec:
            element:
              kind: ElementReference
              name: panel-3
            height: 14
            width: 6
            x: 0
            'y': 0
        - kind: GridLayoutItem
          spec:
            element:
              kind: ElementReference
              name: panel-1
            height: 14
            width: 12
            x: 6
            'y': 0
        - kind: GridLayoutItem
          spec:
            element:
              kind: ElementReference
              name: panel-5
            height: 14
            width: 6
            x: 18
            'y': 0
        - kind: GridLayoutItem
          spec:
            element:
              kind: ElementReference
              name: panel-4
            height: 16
            width: 24
            x: 0
            'y': 14
        - kind: GridLayoutItem
          spec:
            element:
              kind: ElementReference
              name: panel-2
            height: 11
            width: 24
            x: 0
            'y': 30
  links: []
  liveNow: false
  preload: false
  tags:
    - csp
    - nel
    - dmarc
    - smtp-tls
  timeSettings:
    autoRefresh: ''
    autoRefreshIntervals:
      - 5s
      - 10s
      - 30s
      - 1m
      - 5m
      - 15m
      - 30m
      - 1h
      - 2h
      - 1d
    fiscalYearStartMonth: 0
    from: now-24h
    hideTimepicker: false
    timezone: browser
    to: now
  title: Network Reports
  variables: []
status: {}
